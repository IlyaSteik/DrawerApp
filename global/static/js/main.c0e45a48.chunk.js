(window.webpackJsonpminiapp=window.webpackJsonpminiapp||[]).push([[0],{212:function(n,e,t){n.exports=t(336)},302:function(n,e,t){},303:function(n,e,t){},304:function(n,e,t){},306:function(n,e,t){},336:function(n,e,t){"use strict";t.r(e);t(213),t(239),t(241),t(242),t(244),t(245),t(246),t(247),t(248),t(249),t(250),t(251),t(253),t(254),t(255),t(256),t(257),t(258),t(259),t(260),t(261),t(262),t(264),t(265),t(266),t(267),t(268),t(269),t(270),t(271),t(272),t(273),t(274),t(275),t(276),t(277),t(278),t(279),t(280),t(281);var o=t(0),c=t.n(o),a=t(52),i=t.n(a),r=(t(289),t(290),t(33)),s=(t(302),t(303),t(304),t(11)),u=t.n(s),l=t(38),b=t(23),h=t(53),d=t(54),f=t(111),p=t(108),v=t(55),m=t(112),k=t(41),y=t.n(k);t(306),t(109);function g(){return window.location.search.length>0&&JSON.parse('{"'+decodeURI(window.location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}var w=t(110),O=t.n(w),C=new(function(){function n(){Object(h.a)(this,n),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.onConnectionError=this.onConnectionError.bind(this),this.getSocket=this.getSocket.bind(this)}return Object(d.a)(n,[{key:"onConnect",value:function(n){this.socket.on("connect",n)}},{key:"onDisconnect",value:function(n){this.socket.on("disconnect",n)}},{key:"onConnectionError",value:function(n){this.socket.on("connect_error",n)}},{key:"call",value:function(n,e,t){this.socket.emit(n,e,t)}},{key:"subscribe",value:function(n,e){this.socket.on(n,e)}},{key:"unsubscribe",value:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];for(var o=0,c=e;o<c.length;o++){var a=c[o];this.socket.removeAllListeners(a)}}},{key:"connect",value:function(n,e){this.socket?this.socket.connect():this.socket=O.a.connect(n,{path:"/socket.io",query:e,transports:["websocket","polling","flashsocket"],reconnection:!1})}},{key:"getSocket",value:function(){return this.socket}}]),n}()),E=function(n){function e(n){var t;return Object(h.a)(this,e),(t=Object(f.a)(this,Object(p.a)(e).call(this,n))).state={lobbies:[],hidden:[],maxOnline:0,minOnline:0},t.componentDidMount=t.componentDidMount.bind(Object(v.a)(t)),t.socket=C,y.a.send("VKWebAppInit"),t}return Object(m.a)(e,n),Object(d.a)(e,[{key:"componentDidMount",value:function(){var n=Object(b.a)(u.a.mark((function n(){var e=this;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.connect(),C.unsubscribe("gameStart","draw"),C.subscribe("exit",(function(n){console.log("Exit application",n)})),C.onConnectionError((function(n){console.log("Connection Error"),setTimeout((function(){e.connect()}),1e3)})),C.onDisconnect((function(){console.log("Disconnected")})),C.subscribe("gameStart",function(){var n=Object(b.a)(u.a.mark((function n(t){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.setState({lobbies:[].concat(Object(l.a)(e.state.lobbies),[t.lobbyId])});case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),C.subscribe("draw",(function(n){var t=n.data,o=t.lobbyId,c=t.x0,a=t.y0,i=t.x1,r=t.y1,s=t.color;e.drawLine(o,c,a,i,r,s)})),C.subscribe("clear",(function(n){e["canvas".concat(n.lobbyId)]&&e["canvas".concat(n.lobbyId)].getContext("2d").clearRect(0,0,319,319)})),C.subscribe("changeOnline",(function(n){var t=e.state,o=t.maxOnline,c=t.minOnline;e.setState({maxOnline:Math.max(o,n.count),minOnline:Math.min(c,n.count)})})),C.onConnect(Object(b.a)(u.a.mark((function n(){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("Connected"),C.call("games.joinGlobal");case 2:case"end":return n.stop()}}),n)}))));case 10:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}()},{key:"connect",value:function(){C.connect("https://draw.avocado.special.vk-apps.com",g())}},{key:"drawLine",value:function(n,e,t,o,c,a){try{var i=this["canvas".concat(n)],r=i.getContext("2d");if(!i)return;r.beginPath(),r.moveTo(e,t),r.lineTo(o,c),r.strokeStyle=a,r.lineWidth=2,r.stroke(),r.closePath()}catch(s){}}},{key:"render",value:function(){var n=this,e=this.state,t=e.lobbies,o=e.hidden,a=e.popout;return c.a.createElement(r.f,{activePanel:"global",popout:a},c.a.createElement(r.d,{id:"global"},c.a.createElement(r.e,{separator:!1},"\u0422\u0435\u043a\u0443\u0449\u0438\u0435 \u0438\u0433\u0440\u044b"),c.a.createElement("div",{className:"CanvasGrid"},t.map((function(e,t){return c.a.createElement("div",{style:{display:o.indexOf(e)>-1&&"none"},key:"div__".concat(t),className:"Canvas_Container",onClick:function(){n.setState({hidden:[].concat(Object(l.a)(o),[e])})}},c.a.createElement("canvas",{width:319,height:319,ref:function(t){return n["canvas".concat(e)]=t}}))})))))}}]),e}(c.a.Component);i.a.render(c.a.createElement(r.c,null,c.a.createElement(r.a,null,c.a.createElement(r.b,null,c.a.createElement(E,null)))),document.getElementById("root"))}},[[212,1,2]]]);
//# sourceMappingURL=main.c0e45a48.chunk.js.map