(window.webpackJsonpminiapp=window.webpackJsonpminiapp||[]).push([[0],{528:function(e,t,n){e.exports=n(981)},614:function(e,t,n){},615:function(e,t,n){},616:function(e,t,n){},618:function(e,t,n){},635:function(e,t){},637:function(e,t){},667:function(e,t){},668:function(e,t){},712:function(e,t){},714:function(e,t){},737:function(e,t){},981:function(e,t,n){"use strict";n.r(t);n(529),n(555),n(557),n(558),n(560),n(561),n(562),n(563),n(564),n(565),n(566),n(567),n(569),n(570),n(571),n(572),n(573),n(574),n(575),n(576),n(577),n(578),n(580),n(581),n(582),n(583),n(584),n(585),n(586),n(587),n(588),n(589),n(590),n(591),n(592),n(593),n(594),n(595),n(596),n(597);var a=n(0),c=n.n(a),o=n(114),r=n.n(o),i=(n(605),n(606),n(41)),s=(n(614),n(615),n(616),n(17)),l=n.n(s),u=n(82),m=n(40),b=n(180),d=n(181),f=n(419),h=n(398),p=n(182),g=n(399),v=n(49),k=n.n(v),y=n(985),w=n(415),O=n(416),E=n(150),j=n(153),S=n(418);n(618),n(189),n(178),n(620);function C(){return window.location.search.length>0&&JSON.parse('{"'+decodeURI(window.location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}var _=n(401),x=n.n(_),D=function(){function e(){Object(b.a)(this,e),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.onConnectionError=this.onConnectionError.bind(this),this.getSocket=this.getSocket.bind(this)}return Object(d.a)(e,[{key:"onConnect",value:function(e){this.socket.on("connect",e)}},{key:"onDisconnect",value:function(e){this.socket.on("disconnect",e)}},{key:"onConnectionError",value:function(e){this.socket.on("connect_error",e)}},{key:"call",value:function(e,t,n){this.socket.emit(e,t,n)}},{key:"subscribe",value:function(e,t){this.socket.on(e,t)}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var a=0,c=t;a<c.length;a++){var o=c[a];this.socket.removeAllListeners(o)}}},{key:"connect",value:function(e,t){this.socket?this.socket.connect():this.socket=x.a.connect(e,{path:"/socket.io",query:t,transports:["websocket","polling","flashsocket"],reconnection:!1})}},{key:"getSocket",value:function(){return this.socket}}]),e}(),I=n(983),P=n(984),L=n(989),M=n(990),N=n(991);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=new D,J=function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(f.a)(this,Object(h.a)(t).call(this,e))).state={lobbies:[],maxOnline:0,minOnline:-1,currentOnline:0,urlParams:C(),connected:!1,onlineData:[]},n.componentDidMount=n.componentDidMount.bind(Object(p.a)(n)),n.socket=B,k.a.send("VKWebAppInit"),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(m.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connect(),B.unsubscribe("gameStart","draw"),B.subscribe("exit",(function(e){console.log("Exit application",e),t.setState({connected:!1})})),B.onConnectionError((function(e){console.log("Connection Error"),t.setState({connected:!1}),setTimeout((function(){t.connect()}),1e3)})),B.onDisconnect((function(){console.log("Disconnected"),t.setState({connected:!1})})),B.subscribe("gameStart",function(){var e=Object(m.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({lobbies:T({},t.state.lobbies,Object(u.a)({},n.lobbyId,{end:!1}))});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),B.subscribe("gameEnd",function(){var e=Object(m.a)(l.a.mark((function e(n){var a,c,o,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.lobbyId,c=n.gameId,o=n.word,r=n.winnerId,t.state.lobbies[a]&&t.setState({lobbies:T({},t.state.lobbies,Object(u.a)({},a,{end:!0,word:o,gameId:c,winnerId:r}))});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),B.subscribe("draw",(function(e){var n=!0,a=!1,c=void 0;try{for(var o,r=e.data[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var i=o.value,s=i.x0,l=i.y0,u=i.x1,m=i.y1,b=i.color;t.drawLine(e.lobbyId,s,l,u,m,b)}}catch(d){a=!0,c=d}finally{try{n||null==r.return||r.return()}finally{if(a)throw c}}})),B.subscribe("clear",(function(e){t["canvas".concat(e.lobbyId)]&&t["canvas".concat(e.lobbyId)].getContext("2d").clearRect(0,0,319,319)})),B.subscribe("changeOnline",(function(e){var n=t.state,a=n.maxOnline,c=n.minOnline,o=n.onlineData,r=new Date(Date.now()).toLocaleDateString("ru",{hour:"numeric",minute:"numeric"}).split(", ")[1],i=o[o.length-1],s=i?i.time===r?o.length-1:o.length:0;s===o.length&&o.push({}),o[s].time=r,o[s].max=Math.max(o[s].max||e.count,e.count),o[s].min=Math.min(o[s].min||e.count,e.count),t.setState({maxOnline:Math.max(a,e.count),minOnline:Math.min(c<0?e.count:c,e.count),currentOnline:e.count,onlineData:o})})),B.onConnect(Object(m.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected"),t.setState({connected:!0}),B.call("games.joinGlobal");case 3:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){B.connect("https://draw.avocado.special.vk-apps.com",C())}},{key:"drawLine",value:function(e,t,n,a,c,o){try{var r=this["canvas".concat(e)],i=r.getContext("2d");if(!r)return;i.beginPath(),i.moveTo(t,n),i.lineTo(a,c),i.strokeStyle=o,i.lineWidth=2,i.stroke(),i.closePath()}catch(s){}}},{key:"render",value:function(){var e=this,t=this.state,n=t.urlParams,a=t.lobbies,o=t.popout,r=t.maxOnline,s=t.minOnline,l=t.currentOnline,m=t.manage_elements,b=t.view_games,d=t.connected,f=t.onlineData;return c.a.createElement(i.i,{activePanel:"global",popout:o},c.a.createElement(i.f,{id:"global"},c.a.createElement(i.g,{separator:!1},"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0438\u0433\u0440"),c.a.createElement(i.a,{viewWidth:i.j.MOBILE},c.a.createElement("div",{className:"Stats"},c.a.createElement(i.e,{style:{width:320},icon:c.a.createElement(I.a,null),header:"\u041e\u043d\u043b\u0430\u0439\u043d",subheader:c.a.createElement("span",null,"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",r,c.a.createElement("br",null),"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",s,c.a.createElement("br",null),"\u0422\u0435\u043a\u0443\u0449\u0438\u0439: ",l),actions:c.a.createElement(i.c,{size:"l",onClick:function(){d?B.getSocket().disconnect():e.connect()}},d?"\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f":"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f")}),c.a.createElement(i.e,{style:{width:320},icon:c.a.createElement(P.a,null),header:"\u0412\u043d\u0435\u0448\u043d\u0438\u0439 \u0432\u0438\u0434",actionsLayout:"vertical",actions:[c.a.createElement(i.c,{size:"l",mode:"neutral",after:c.a.createElement(i.h,{getRef:function(t){return e.manage_elements_ref=t},onChange:function(){return e.setState({manage_elements:!m})}}),onClick:function(){return e.manage_elements_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0438"),c.a.createElement(i.c,{size:"l",mode:"neutral",after:c.a.createElement(i.h,{getRef:function(t){return e.view_games_ref=t},onChange:function(){return e.setState({view_games:!b})}}),onClick:function(){return e.view_games_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u0438\u0433\u0440\u044b")]}),c.a.createElement(y.a,{width:800,height:268,data:JSON.parse(JSON.stringify(f))},c.a.createElement(w.a,{dataKey:"time"}),c.a.createElement(O.a,null),c.a.createElement(E.a,null),c.a.createElement(j.a,null),c.a.createElement(S.a,{type:"monotone",dataKey:"max",stroke:"#4BB34B"}),c.a.createElement(S.a,{type:"monotone",dataKey:"min",stroke:"#E64646"})))),c.a.createElement("div",{className:"CanvasGrid"},Object.keys(a).map((function(t,o){return c.a.createElement("div",{style:{display:b&&"none"},key:"div__".concat(o),className:"Canvas_Container"},a[t].end&&!m&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,a[t].word.nom.substring(0,1).toUpperCase()+a[t].word.nom.substring(1)),c.a.createElement(L.a,{fill:a[t].isReported&&"#efefef",className:"Report",onClick:function(){a[t].isReported||(B.call("games.report",{game_id:a[t].gameId}),e.setState({lobbies:T({},e.state.lobbies,Object(u.a)({},t,T({},a[t],{isReported:!0})))}))}}),c.a.createElement(M.a,{fill:a[t].isLiked?"#F16384":"var(--color_secondary)",className:"Like",onClick:function(){B.call("pictures.like",{game_id:a[t].gameId},(function(n){e.setState({lobbies:T({},e.state.lobbies,Object(u.a)({},t,T({},a[t],{isLiked:n.response.isLiked})))})}))}}),245481845==n.vk_user_id&&c.a.createElement(i.c,{before:c.a.createElement(N.a,{width:16,height:16}),size:"m",mode:"gradient_blue",onClick:function(){B.call("users.giveCreative",{user_id:a[t].winnerId,status:!a[t].gaveTag},(function(n){e.setState({lobbies:T({},e.state.lobbies,Object(u.a)({},t,T({},a[t],{gaveTag:n.response.tag_creative})))})}))}},a[t].gaveTag?"\u0417\u0430\u0431\u0440\u0430\u0442\u044c":"\u0412\u044b\u0434\u0430\u0442\u044c"," \u043c\u0435\u0442\u043a\u0443")),c.a.createElement("canvas",{id:a[t].gameId?"game_".concat(a[t].gameId):"lobby_".concat(t),width:319,height:319,ref:function(n){return e["canvas".concat(t)]=n}}))})))))}}]),t}(c.a.Component);r.a.render(c.a.createElement(i.d,null,c.a.createElement(i.a,null,c.a.createElement(i.b,null,c.a.createElement(J,null)))),document.getElementById("root"))}},[[528,1,2]]]);
//# sourceMappingURL=main.0640e668.chunk.js.map