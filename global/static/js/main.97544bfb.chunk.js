(window.webpackJsonpminiapp=window.webpackJsonpminiapp||[]).push([[0],{359:function(e,t,n){e.exports=n(616)},449:function(e,t,n){},450:function(e,t,n){},451:function(e,t,n){},453:function(e,t,n){},616:function(e,t,n){"use strict";n.r(t);n(360),n(386),n(388),n(389),n(391),n(392),n(393),n(394),n(395),n(396),n(397),n(398),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428);var a=n(0),c=n.n(a),o=n(87),r=n.n(o),i=(n(436),n(437),n(32)),s=(n(449),n(450),n(451),n(96)),l=n(27),u=n.n(l),m=n(62),b=n(44),d=n(129),f=n(130),p=n(266),h=n(245),g=n(131),v=n(246),k=n(88),y=n.n(k),w=n(620),O=n(262),E=n(263),j=n(113),C=n(265);n(453);function _(){return window.location.search.length>0&&JSON.parse('{"'+decodeURI(window.location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}var S=n(248),D=n.n(S),I=function(){function e(){Object(d.a)(this,e),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.onConnectionError=this.onConnectionError.bind(this),this.getSocket=this.getSocket.bind(this)}return Object(f.a)(e,[{key:"onConnect",value:function(e){this.socket.on("connect",e)}},{key:"onDisconnect",value:function(e){this.socket.on("disconnect",e)}},{key:"onConnectionError",value:function(e){this.socket.on("connect_error",e)}},{key:"call",value:function(e,t,n){this.socket.emit(e,t,n)}},{key:"subscribe",value:function(e,t){this.socket.on(e,t)}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var a=0,c=t;a<c.length;a++){var o=c[a];this.socket.removeAllListeners(o)}}},{key:"connect",value:function(e,t){this.socket?this.socket.connect():this.socket=D.a.connect(e,{path:"/socket.io",query:t,transports:["websocket","polling","flashsocket"],reconnection:!1})}},{key:"getSocket",value:function(){return this.socket}}]),e}(),x=n(618),P=n(619),L=n(624),R=n(625),M=n(626);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=new I,A=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={lobbies:[],maxOnline:0,minOnline:-1,currentOnline:0,urlParams:_(),connected:!1,onlineData:[]},n.componentDidMount=n.componentDidMount.bind(Object(g.a)(n)),n.socket=z,y.a.send("VKWebAppInit"),n}return Object(v.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=Object(b.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connect(),z.unsubscribe("gameStart","draw"),z.subscribe("exit",(function(e){console.log("Exit application",e),t.setState({connected:!1})})),z.onConnectionError((function(e){console.log("Connection Error"),t.setState({connected:!1}),setTimeout((function(){t.connect()}),1e3)})),z.onDisconnect((function(){console.log("Disconnected"),t.setState({connected:!1})})),z.subscribe("gameStart",function(){var e=Object(b.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({lobbies:T({},t.state.lobbies,Object(m.a)({},n.lobbyId,{end:!1}))});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),z.subscribe("gameEnd",function(){var e=Object(b.a)(u.a.mark((function e(n){var a,c,o,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.lobbyId,c=n.gameId,o=n.word,r=n.winnerId,t.state.lobbies[a]&&t.setState({lobbies:T({},t.state.lobbies,Object(m.a)({},a,{end:!0,word:o,gameId:c,winnerId:r}))});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),z.subscribe("draw",(function(e){var n=e.data,a=n.lobbyId,c=n.x0,o=n.y0,r=n.x1,i=n.y1,s=n.color;t.drawLine(a,c,o,r,i,s)})),z.subscribe("clear",(function(e){t["canvas".concat(e.lobbyId)]&&t["canvas".concat(e.lobbyId)].getContext("2d").clearRect(0,0,319,319)})),z.subscribe("changeOnline",(function(e){var n=t.state,a=n.maxOnline,c=n.minOnline;t.setState({maxOnline:Math.max(a,e.count),minOnline:Math.min(c<0?e.count:c,e.count),currentOnline:e.count,onlineData:[].concat(Object(s.a)(t.state.onlineData),[{time:new Date(Date.now()).toLocaleDateString("ru",{hour:"numeric",minute:"numeric",second:"numeric"}).split(", ")[1],online:e.count}])})})),z.onConnect(Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected"),t.setState({connected:!0}),z.call("games.joinGlobal");case 3:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){z.connect("https://draw.avocado.special.vk-apps.com",_())}},{key:"drawLine",value:function(e,t,n,a,c,o){try{var r=this["canvas".concat(e)],i=r.getContext("2d");if(!r)return;i.beginPath(),i.moveTo(t,n),i.lineTo(a,c),i.strokeStyle=o,i.lineWidth=2,i.stroke(),i.closePath()}catch(s){}}},{key:"render",value:function(){var e=this,t=this.state,n=t.urlParams,a=t.lobbies,o=t.popout,r=t.maxOnline,s=t.minOnline,l=t.currentOnline,u=t.manage_elements,b=t.view_games,d=t.connected,f=t.onlineData;return c.a.createElement(i.i,{activePanel:"global",popout:o},c.a.createElement(i.f,{id:"global"},c.a.createElement(i.g,{separator:!1},"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0438\u0433\u0440"),c.a.createElement(i.a,{viewWidth:i.j.MOBILE},c.a.createElement("div",{className:"Stats"},c.a.createElement(i.e,{style:{width:320},icon:c.a.createElement(x.a,null),header:"\u041e\u043d\u043b\u0430\u0439\u043d",subheader:c.a.createElement("span",null,"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",r,c.a.createElement("br",null),"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",s,c.a.createElement("br",null),"\u0422\u0435\u043a\u0443\u0449\u0438\u0439: ",l),actions:c.a.createElement(i.c,{size:"l",onClick:function(){d?z.getSocket().disconnect():e.connect()}},d?"\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f":"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f")}),c.a.createElement(i.e,{style:{width:320},icon:c.a.createElement(P.a,null),header:"\u0412\u043d\u0435\u0448\u043d\u0438\u0439 \u0432\u0438\u0434",actionsLayout:"vertical",actions:[c.a.createElement(i.c,{size:"l",mode:"neutral",after:c.a.createElement(i.h,{getRef:function(t){return e.manage_elements_ref=t},onChange:function(){return e.setState({manage_elements:!u})}}),onClick:function(){return e.manage_elements_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0438"),c.a.createElement(i.c,{size:"l",mode:"neutral",after:c.a.createElement(i.h,{getRef:function(t){return e.view_games_ref=t},onChange:function(){return e.setState({view_games:!b})}}),onClick:function(){return e.view_games_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u0438\u0433\u0440\u044b")]}),c.a.createElement(w.a,{width:800,height:268,data:f},c.a.createElement(O.a,{dataKey:"time"}),c.a.createElement(E.a,{dataKey:"online"}),c.a.createElement(j.a,null),c.a.createElement(C.a,{type:"monotone",dataKey:"online",stroke:"#3f8ae0",yAxisId:0})))),c.a.createElement("div",{className:"CanvasGrid"},Object.keys(a).map((function(t,o){return c.a.createElement("div",{style:{display:b&&"none"},key:"div__".concat(o),className:"Canvas_Container"},a[t].end&&!u&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,a[t].word.nom.substring(0,1).toUpperCase()+a[t].word.nom.substring(1)),c.a.createElement(L.a,{fill:a[t].isReported&&"#efefef",className:"Report",onClick:function(){a[t].isReported||(z.call("games.report",{game_id:a[t].gameId}),e.setState({lobbies:T({},e.state.lobbies,Object(m.a)({},t,T({},a[t],{isReported:!0})))}))}}),c.a.createElement(R.a,{fill:a[t].isLiked?"#F16384":"var(--color_secondary)",className:"Like",onClick:function(){z.call("pictures.like",{game_id:a[t].gameId},(function(n){e.setState({lobbies:T({},e.state.lobbies,Object(m.a)({},t,T({},a[t],{isLiked:n.response.isLiked})))})}))}}),245481845==n.vk_user_id&&c.a.createElement(i.c,{before:c.a.createElement(M.a,{width:16,height:16}),size:"m",mode:"gradient_blue",onClick:function(){z.call("users.giveCreative",{user_id:a[t].winnerId,status:!a[t].gaveTag},(function(n){e.setState({lobbies:T({},e.state.lobbies,Object(m.a)({},t,T({},a[t],{gaveTag:n.response})))})}))}},a[t].gaveTag?"\u0417\u0430\u0431\u0440\u0430\u0442\u044c":"\u0412\u044b\u0434\u0430\u0442\u044c"," \u043c\u0435\u0442\u043a\u0443")),c.a.createElement("canvas",{id:a[t].gameId?"game_".concat(a[t].gameId):"lobby_".concat(t),width:319,height:319,ref:function(n){return e["canvas".concat(t)]=n}}))})))))}}]),t}(c.a.Component);r.a.render(c.a.createElement(i.d,null,c.a.createElement(i.a,null,c.a.createElement(i.b,null,c.a.createElement(A,null)))),document.getElementById("root"))}},[[359,1,2]]]);
//# sourceMappingURL=main.97544bfb.chunk.js.map