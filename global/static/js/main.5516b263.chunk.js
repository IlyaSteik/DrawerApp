(window.webpackJsonpminiapp=window.webpackJsonpminiapp||[]).push([[0],{208:function(e,t,n){e.exports=n(332)},298:function(e,t,n){},299:function(e,t,n){},300:function(e,t,n){},302:function(e,t,n){},332:function(e,t,n){"use strict";n.r(t);n(209),n(235),n(237),n(238),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277);var a=n(0),c=n.n(a),o=n(58),r=n.n(o),i=(n(285),n(286),n(16)),s=(n(298),n(299),n(300),n(15)),l=n.n(s),u=n(34),b=n(22),m=n(59),d=n(60),f=n(118),p=n(116),h=n(61),g=n(119),v=n(45),k=n.n(v);n(302),n(62);function w(){return window.location.search.length>0&&JSON.parse('{"'+decodeURI(window.location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}var O=n(117),y=n.n(O),E=function(){function e(){Object(m.a)(this,e),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.onConnectionError=this.onConnectionError.bind(this),this.getSocket=this.getSocket.bind(this)}return Object(d.a)(e,[{key:"onConnect",value:function(e){this.socket.on("connect",e)}},{key:"onDisconnect",value:function(e){this.socket.on("disconnect",e)}},{key:"onConnectionError",value:function(e){this.socket.on("connect_error",e)}},{key:"call",value:function(e,t,n){this.socket.emit(e,t,n)}},{key:"subscribe",value:function(e,t){this.socket.on(e,t)}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var a=0,c=t;a<c.length;a++){var o=c[a];this.socket.removeAllListeners(o)}}},{key:"connect",value:function(e,t){this.socket?this.socket.connect():this.socket=y.a.connect(e,{path:"/socket.io",query:t,transports:["websocket","polling","flashsocket"],reconnection:!1})}},{key:"getSocket",value:function(){return this.socket}}]),e}(),j=n(333),C=n(334),_=n(335),S=n(336),I=n(337);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){Object(u.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=new E,L=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this,e))).state={lobbies:[],maxOnline:0,minOnline:-1,currentOnline:0,urlParams:w(),connected:!1},n.componentDidMount=n.componentDidMount.bind(Object(h.a)(n)),n.socket=D,k.a.send("VKWebAppInit"),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(b.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connect(),D.unsubscribe("gameStart","draw"),D.subscribe("exit",(function(e){console.log("Exit application",e),t.setState({connected:!1})})),D.onConnectionError((function(e){console.log("Connection Error"),t.setState({connected:!1}),setTimeout((function(){t.connect()}),1e3)})),D.onDisconnect((function(){console.log("Disconnected"),t.setState({connected:!1})})),D.subscribe("gameStart",function(){var e=Object(b.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({lobbies:P({},t.state.lobbies,Object(u.a)({},n.lobbyId,{end:!1}))});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),D.subscribe("gameEnd",function(){var e=Object(b.a)(l.a.mark((function e(n){var a,c,o,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.lobbyId,c=n.gameId,o=n.word,r=n.winnerId,t.state.lobbies[a]&&t.setState({lobbies:P({},t.state.lobbies,Object(u.a)({},a,{end:!0,word:o,gameId:c,winnerId:r}))});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),D.subscribe("draw",(function(e){var n=e.data,a=n.lobbyId,c=n.x0,o=n.y0,r=n.x1,i=n.y1,s=n.color;t.drawLine(a,c,o,r,i,s)})),D.subscribe("clear",(function(e){t["canvas".concat(e.lobbyId)]&&t["canvas".concat(e.lobbyId)].getContext("2d").clearRect(0,0,319,319)})),D.subscribe("changeOnline",(function(e){var n=t.state,a=n.maxOnline,c=n.minOnline;t.setState({maxOnline:Math.max(a,e.count),minOnline:Math.min(c<0?e.count:c,e.count),currentOnline:e.count})})),D.onConnect(Object(b.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected"),t.setState({connected:!0}),D.call("games.joinGlobal");case 3:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){D.connect("https://draw.avocado.special.vk-apps.com",w())}},{key:"drawLine",value:function(e,t,n,a,c,o){try{var r=this["canvas".concat(e)],i=r.getContext("2d");if(!r)return;i.beginPath(),i.moveTo(t,n),i.lineTo(a,c),i.strokeStyle=o,i.lineWidth=2,i.stroke(),i.closePath()}catch(s){}}},{key:"render",value:function(){var e=this,t=this.state,n=t.urlParams,a=t.lobbies,o=t.popout,r=t.maxOnline,s=t.minOnline,l=t.currentOnline,b=t.manage_elements,m=t.view_games,d=t.connected;return c.a.createElement(i.i,{activePanel:"global",popout:o},c.a.createElement(i.f,{id:"global"},c.a.createElement(i.g,{separator:!1},"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0438\u0433\u0440"),c.a.createElement(i.a,{viewWidth:i.j.MOBILE},c.a.createElement("div",{className:"Stats"},c.a.createElement(i.e,{style:{width:320},icon:c.a.createElement(j.a,null),header:"\u041e\u043d\u043b\u0430\u0439\u043d",subheader:c.a.createElement("span",null,"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",r,c.a.createElement("br",null),"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",s,c.a.createElement("br",null),"\u0422\u0435\u043a\u0443\u0449\u0438\u0439: ",l),actions:c.a.createElement(i.c,{size:"l",onClick:function(){d?D.getSocket().disconnect():e.connect()}},d?"\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f":"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f")}),c.a.createElement(i.e,{style:{width:320},icon:c.a.createElement(C.a,null),header:"\u0412\u043d\u0435\u0448\u043d\u0438\u0439 \u0432\u0438\u0434",actionsLayout:"vertical",actions:[c.a.createElement(i.c,{size:"l",mode:"neutral",after:c.a.createElement(i.h,{getRef:function(t){return e.manage_elements_ref=t},onChange:function(){return e.setState({manage_elements:!b})}}),onClick:function(){return e.manage_elements_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0438"),c.a.createElement(i.c,{size:"l",mode:"neutral",after:c.a.createElement(i.h,{getRef:function(t){return e.view_games_ref=t},onChange:function(){return e.setState({view_games:!m})}}),onClick:function(){return e.view_games_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u0438\u0433\u0440\u044b")]}))),c.a.createElement("div",{className:"CanvasGrid"},Object.keys(a).map((function(t,o){return c.a.createElement("div",{style:{display:m&&"none"},key:"div__".concat(o),className:"Canvas_Container",onClick:function(){}},a[t].end&&!b&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,a[t].word.nom.substring(0,1).toUpperCase()+a[t].word.nom.substring(1)),c.a.createElement(_.a,{fill:a[t].isReported&&"#efefef",className:"Report",onClick:function(){a[t].isReported||(D.call("games.report",{game_id:a[t].gameId}),e.setState({lobbies:P({},e.state.lobbies,Object(u.a)({},t,P({},a[t],{isReported:!0})))}))}}),c.a.createElement(S.a,{fill:a[t].isLiked?"#F16384":"var(--color_secondary)",className:"Like",onClick:function(){D.call("pictures.like",{game_id:a[t].gameId},(function(n){e.setState({lobbies:P({},e.state.lobbies,Object(u.a)({},t,P({},a[t],{isLiked:n.response.isLiked})))})}))}}),245481845==n.vk_user_id&&c.a.createElement(i.c,{before:c.a.createElement(I.a,{width:16,height:16}),size:"m",mode:"gradient_blue",onClick:function(){D.call("users.giveCreative",{user_id:a[t].winnerId,status:!a[t].gaveTag},(function(n){e.setState({lobbies:P({},e.state.lobbies,Object(u.a)({},t,P({},a[t],{gaveTag:n.response})))})}))}},a[t].gaveTag?"\u0417\u0430\u0431\u0440\u0430\u0442\u044c":"\u0412\u044b\u0434\u0430\u0442\u044c"," \u043c\u0435\u0442\u043a\u0443")),c.a.createElement("canvas",{id:a[t].gameId?"game_".concat(a[t].gameId):"lobby_".concat(t),width:319,height:319,ref:function(n){return e["canvas".concat(t)]=n}}))})))))}}]),t}(c.a.Component);r.a.render(c.a.createElement(i.d,null,c.a.createElement(i.a,null,c.a.createElement(i.b,null,c.a.createElement(L,null)))),document.getElementById("root"))}},[[208,1,2]]]);
//# sourceMappingURL=main.5516b263.chunk.js.map