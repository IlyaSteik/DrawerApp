(window.webpackJsonpminiapp=window.webpackJsonpminiapp||[]).push([[0],{413:function(e,t,n){e.exports=n(702)},520:function(e,t,n){},521:function(e,t,n){},522:function(e,t,n){},524:function(e,t,n){},702:function(e,t,n){"use strict";n.r(t);n(414),n(448),n(450),n(452),n(454),n(455),n(456),n(457),n(458),n(459),n(462),n(463),n(465),n(466),n(467),n(468),n(469),n(470),n(472),n(473),n(474),n(475),n(476),n(477),n(480),n(481),n(482),n(483),n(484),n(486),n(488),n(490),n(492),n(493),n(494),n(495),n(496),n(497),n(499),n(501);var a=n(93),o=n(94),c=n(148),r=n(142),i=n(143),s=n(0),l=n.n(s),u=n(92),m=n.n(u),d=(n(510),n(511),n(28)),b=(n(520),n(521),n(522),n(33)),f=n.n(b),h=n(11),p=n.n(h),g=n(68),v=n(25),y=n(141),k=n(706),O=n(301),w=n(302),E=n(116),C=n(119),j=n(304);n(524),n(151),n(139),n(190);function _(){var e=window.location.search.length>0&&JSON.parse('{"'+decodeURI(window.location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');return e&&e.vk_chat_id&&(e.vk_chat_id=decodeURIComponent(e.vk_chat_id)),e}var S=n(287),x=n.n(S),I=function(){function e(){Object(a.a)(this,e),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.onConnectionError=this.onConnectionError.bind(this),this.getSocket=this.getSocket.bind(this)}return Object(o.a)(e,[{key:"onConnect",value:function(e){this.socket.on("connect",e)}},{key:"onDisconnect",value:function(e){this.socket.on("disconnect",e)}},{key:"onConnectionError",value:function(e){this.socket.on("connect_error",e)}},{key:"call",value:function(e,t,n){this.socket.emit(e,t,n)}},{key:"subscribe",value:function(e,t){this.socket.on(e,t)}},{key:"unsubscribe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var a=0,o=t;a<o.length;a++){var c=o[a];this.socket.removeAllListeners(c)}}},{key:"connect",value:function(e,t){this.socket?this.socket.connect():this.socket=x.a.connect(e,{path:"/socket.io",query:t,transports:["websocket","polling","flashsocket"],reconnection:!1,pingTimeout:6e4})}},{key:"getSocket",value:function(){return this.socket}}]),e}(),D=n(704),P=n(705),L=n(710),M=n(711),R=n(712);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(n,!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=new I,J={},A=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={lobbies:[],maxOnline:0,minOnline:-1,currentOnline:0,urlParams:_(),connected:!1,onlineData:[]},n.componentDidMount=n.componentDidMount.bind(Object(y.a)(n)),n.socket=W,f.a.send("VKWebAppInit"),n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=Object(v.a)(p.a.mark((function e(){var t=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.connect(),W.unsubscribe("gameStart","draw"),W.subscribe("exit",(function(e){console.log("Exit application",e),t.setState({connected:!1})})),W.onConnectionError((function(e){console.log("Connection Error"),t.setState({connected:!1}),setTimeout((function(){t.connect()}),1e3)})),W.onDisconnect((function(){console.log("Disconnected"),t.setState({connected:!1})})),W.subscribe("gameStart",function(){var e=Object(v.a)(p.a.mark((function e(n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({lobbies:N({},t.state.lobbies,Object(g.a)({},n.lobbyId,{end:!1}))});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),W.subscribe("gameEnd",function(){var e=Object(v.a)(p.a.mark((function e(n){var a,o,c,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.lobbyId,o=n.gameId,c=n.word,r=n.winnerId,t.state.lobbies[a]&&t.setState({lobbies:N({},t.state.lobbies,Object(g.a)({},a,{end:!0,word:c,gameId:o,winnerId:r}))});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),W.subscribe("draw",(function(e){var n=!0,a=!1,o=void 0;try{for(var c,r=e.data[Symbol.iterator]();!(n=(c=r.next()).done);n=!0){var i=c.value,s=i.x0,l=i.y0,u=i.x1,m=i.y1,d=i.color,b=i.isEraser,f=i.lineWidth;t.drawLine(e.lobbyId,s,l,u,m,d,b,f)}}catch(h){a=!0,o=h}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}})),W.subscribe("undo",(function(e){t.undoDraw(e.lobbyId)})),W.subscribe("clear",(function(e){t["canvas".concat(e.lobbyId)]&&t["canvas".concat(e.lobbyId)].getContext("2d").clearRect(0,0,319,319)})),W.subscribe("changeOnline",(function(e){var n=t.state,a=n.maxOnline,o=n.minOnline,c=n.onlineData,r=new Date(Date.now()).toLocaleDateString("ru",{hour:"numeric",minute:"numeric"}).split(", ")[1],i=c[c.length-1],s=i?i.time===r?c.length-1:c.length:0;s===c.length&&c.push({}),c[s].time=r,c[s].max=Math.max(c[s].max||e.count,e.count),c[s].min=Math.min(c[s].min||e.count,e.count),t.setState({maxOnline:Math.max(a,e.count),minOnline:Math.min(o<0?e.count:o,e.count),currentOnline:e.count,onlineData:c})})),W.onConnect(Object(v.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Connected"),t.setState({connected:!0}),W.call("games.joinGlobal");case 3:case"end":return e.stop()}}),e)}))));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){W.connect("https://draw.avocado.special.vk-apps.com",_())}},{key:"drawLine",value:function(e,t,n,a,o,c,r,i){try{var s=this["canvas".concat(e)],l=s.getContext("2d");if(!s)return;r?(l.globalCompositeOperation="destination-out",l.arc(2*t,2*n,1.2*i,0,2*Math.PI,!1),l.fill()):(l.globalCompositeOperation="source-over",l.moveTo(2*t,2*n),l.lineTo(2*a,2*o),l.strokeStyle=c,l.fill(),l.lineWidth=i,l.lineCap=l.lineJoin="round",l.stroke()),J[e]||(J[e]=[]),J[e].push({x0:t,y0:n,x1:a,y1:o,color:c,isEraser:r,lineWidth:i})}catch(u){}}},{key:"undoDraw",value:function(e){try{var t=this["canvas".concat(e)],n=t.getContext("2d"),a=J[e];if(!t||!a)return;J[e].splice(a.length-1,1),n.clearRect(0,0,638,638),a.length>0&&(a.forEach((function(e){e.forEach((function(e){var t=e.x0,a=e.y0,o=e.x1,c=e.y1,r=e.color,i=e.isEraser,s=e.lineWidth;n.beginPath(),i?(n.globalCompositeOperation="destination-out",n.arc(2*t,2*a,1.2*s,0,2*Math.PI,!1),n.fill()):(n.globalCompositeOperation="source-over",n.moveTo(2*t,2*a),n.lineTo(2*o,2*c),n.strokeStyle=r,n.fill(),n.lineWidth=s,n.lineCap=n.lineJoin="round",n.stroke())}))})),n.closePath())}catch(o){}}},{key:"render",value:function(){var e=this,t=this.state,n=t.urlParams,a=t.lobbies,o=t.popout,c=t.maxOnline,r=t.minOnline,i=t.currentOnline,s=t.manage_elements,u=t.view_games,m=t.connected,b=t.onlineData;return l.a.createElement(d.i,{activePanel:"global",popout:o},l.a.createElement(d.f,{id:"global"},l.a.createElement(d.g,{separator:!1},"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0438\u0433\u0440"),l.a.createElement(d.a,{viewWidth:d.j.MOBILE},l.a.createElement("div",{className:"Stats"},l.a.createElement(d.e,{style:{width:320},icon:l.a.createElement(D.a,null),header:"\u041e\u043d\u043b\u0430\u0439\u043d",subheader:l.a.createElement("span",null,"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",c,l.a.createElement("br",null),"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439: ",r,l.a.createElement("br",null),"\u0422\u0435\u043a\u0443\u0449\u0438\u0439: ",i),actions:l.a.createElement(d.c,{size:"l",onClick:function(){m?W.getSocket().disconnect():e.connect()}},m?"\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f":"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f")}),l.a.createElement(d.e,{style:{width:320},icon:l.a.createElement(P.a,null),header:"\u0412\u043d\u0435\u0448\u043d\u0438\u0439 \u0432\u0438\u0434",actionsLayout:"vertical",actions:[l.a.createElement(d.c,{size:"l",mode:"neutral",after:l.a.createElement(d.h,{getRef:function(t){return e.manage_elements_ref=t},onChange:function(){return e.setState({manage_elements:!s})}}),onClick:function(){return e.manage_elements_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0438"),l.a.createElement(d.c,{size:"l",mode:"neutral",after:l.a.createElement(d.h,{getRef:function(t){return e.view_games_ref=t},onChange:function(){return e.setState({view_games:!u})}}),onClick:function(){return e.view_games_ref.click()}},"\u0421\u043f\u0440\u044f\u0442\u0430\u0442\u044c \u0438\u0433\u0440\u044b")]}),l.a.createElement(k.a,{width:800,height:268,data:JSON.parse(JSON.stringify(b))},l.a.createElement(O.a,{dataKey:"time"}),l.a.createElement(w.a,null),l.a.createElement(E.a,null),l.a.createElement(C.a,null),l.a.createElement(j.a,{type:"monotone",dataKey:"max",stroke:"#4BB34B"}),l.a.createElement(j.a,{type:"monotone",dataKey:"min",stroke:"#E64646"})))),l.a.createElement("div",{className:"CanvasGrid"},!u&&Object.keys(a).map((function(t,o){return l.a.createElement("div",{key:"div__".concat(o),className:"Canvas_Container"},a[t].end&&!s&&l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,a[t].word.nom.substring(0,1).toUpperCase()+a[t].word.nom.substring(1)),l.a.createElement(L.a,{fill:a[t].isReported&&"#efefef",className:"Report",onClick:function(){-1===a[t].gameId||a[t].isReported||(W.call("games.report",{game_id:a[t].gameId}),e.setState({lobbies:N({},e.state.lobbies,Object(g.a)({},t,N({},a[t],{isReported:!0})))}))}}),l.a.createElement(M.a,{fill:a[t].isLiked?"#F16384":"var(--color_secondary)",className:"Like",onClick:function(){-1!==a[t].gameId&&W.call("pictures.like",{game_id:a[t].gameId},(function(n){e.setState({lobbies:N({},e.state.lobbies,Object(g.a)({},t,N({},a[t],{isLiked:n.response.isLiked})))})}))}}),245481845==n.vk_user_id&&l.a.createElement(d.c,{before:l.a.createElement(R.a,{width:16,height:16}),size:"m",mode:"gradient_blue",onClick:function(){W.call("users.giveCreative",{user_id:a[t].winnerId,status:!a[t].gaveTag},(function(n){e.setState({lobbies:N({},e.state.lobbies,Object(g.a)({},t,N({},a[t],{gaveTag:n.response.tag_creative})))})}))}},a[t].gaveTag?"\u0417\u0430\u0431\u0440\u0430\u0442\u044c":"\u0412\u044b\u0434\u0430\u0442\u044c"," \u043c\u0435\u0442\u043a\u0443")),l.a.createElement("canvas",{id:a[t].gameId?"game_".concat(a[t].gameId):"lobby_".concat(t),style:{width:319,height:319},width:638,height:638,ref:function(n){return e["canvas".concat(t)]=n}}))})))))}}]),t}(l.a.Component),B=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={},n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;f.a.subscribe((function(t){var n=t.detail,a=n.type,o=n.data;"VKWebAppUpdateConfig"===a&&e.setState({appearance:o.appearance})}))}},{key:"render",value:function(){return l.a.createElement(d.d,{webviewType:d.k.INTERNAL,appearance:this.state.appearance},l.a.createElement(d.a,null,l.a.createElement(d.b,null,l.a.createElement(A,null))))}}]),t}(l.a.Component);m.a.render(l.a.createElement(B,null),document.getElementById("root"))}},[[413,1,2]]]);
//# sourceMappingURL=main.e021540f.chunk.js.map